"use strict";((t,e)=>{if(!e)throw new Error("Joomla API is not properly initiated");e.selectedMediaFile={},window.document.addEventListener("onMediaFileSelected",(t=>{e.selectedMediaFile=t.detail;const i=e.Modal.getCurrent(),s=i.querySelector(".modal-body"),a=s.querySelector("joomla-field-mediamore");a&&a.parentNode.removeChild(a),s.closest("joomla-field-media")||e.selectedMediaFile.path&&s.insertAdjacentHTML("afterbegin",`\n<joomla-field-mediamore\n  parent-id="${i.id}"\n  summary-label="${e.Text._("JFIELD_MEDIA_SUMMARY_LABEL")}"\n  lazy-label="${e.Text._("JFIELD_MEDIA_LAZY_LABEL")}"\n  alt-label="${e.Text._("JFIELD_MEDIA_ALT_LABEL")}"\n  alt-check-label="${e.Text._("JFIELD_MEDIA_ALT_CHECK_LABEL")}"\n  alt-check-desc-label="${e.Text._("JFIELD_MEDIA_ALT_CHECK_DESC_LABEL")}"\n  classes-label="${e.Text._("JFIELD_MEDIA_CLASS_LABEL")}"\n  figure-classes-label="${e.Text._("JFIELD_MEDIA_FIGURE_CLASS_LABEL")}"\n  figure-caption-label="${e.Text._("JFIELD_MEDIA_FIGURE_CAPTION_LABEL")}"\n></joomla-field-mediamore>\n`)}));const i=(t,e,i)=>{const s=encodeURIComponent(e),a=encodeURIComponent(i),l=new RegExp(`(&|\\?)${e}=[^&]*`);let n=t;const r=`${s}=${a}`;return n=n.replace(l,`$1${r}`),!RegExp.$1&&n.includes("?")?`${n}&${r}`:RegExp.$1||n.includes("?")?n:`${n}?${r}`},s=(t,s,a)=>{if(!0===t.success){if(t.data[0].url)if(/local-/.test(t.data[0].adapter)){const{rootFull:i}=e.getOptions("system.paths");e.selectedMediaFile.url=t.data[0].url.split(i)[1],t.data[0].thumb_path?e.selectedMediaFile.thumb=t.data[0].thumb_path:e.selectedMediaFile.thumb=!1}else t.data[0].thumb_path&&(e.selectedMediaFile.thumb=t.data[0].thumb_path);else e.selectedMediaFile.url=!1;if(e.selectedMediaFile.url){let t,n="",r="",c="",o="",d="",h="",u="";if(l=s,"object"==typeof HTMLElement?l instanceof HTMLElement:l&&"object"==typeof l&&1===l.nodeType&&"string"==typeof l.nodeName){const t=i(e.selectedMediaFile.url,"joomla_image_width",e.selectedMediaFile.width);s.value=i(t,"joomla_image_height",e.selectedMediaFile.height),a.updatePreview()}else{t=a.closest(".modal-content").querySelector("joomla-field-mediamore"),t&&("true"===t.getAttribute("alt-check")&&(c=' alt=""'),r=t.getAttribute("alt-value")?` alt="${t.getAttribute("alt-value")}"`:c,o=t.getAttribute("img-classes")?` class="${t.getAttribute("img-classes")}"`:"",d=t.getAttribute("fig-classes")?` class="${t.getAttribute("fig-classes")}"`:"",h=t.getAttribute("fig-caption")?`${t.getAttribute("fig-caption")}`:"","true"===t.getAttribute("is-lazy")&&(n=` loading="lazy" width="${e.selectedMediaFile.width}" height="${e.selectedMediaFile.height}"`)),u=h?`<figure${d}><img src="${e.selectedMediaFile.url}"${o}${n}${r}/><figcaption>${h}</figcaption></figure>`:`<img src="${e.selectedMediaFile.url}"${o}${n}${r}/>`,t&&t.parentNode.removeChild(t),e.editors.instances[s].replaceSelection(u)}}}var l};e.getImage=(t,i,a)=>new Promise(((l,n)=>{if(!t||"object"==typeof t&&(!t.path||""===t.path))return e.selectedMediaFile={},void l({resp:{success:!1}});const r=`${e.getOptions("system.paths").rootFull}administrator/index.php?option=com_media&format=json`;e.request({url:`${r}&task=api.files&url=true&path=${t.path}&${e.getOptions("csrf.token")}=1&format=json`,method:"GET",perform:!0,headers:{"Content-Type":"application/json"},onSuccess:t=>{const e=JSON.parse(t);l(s(e,i,a))},onError:t=>{n(t)}})}));class a extends HTMLElement{constructor(){super(),this.lazyInputFn=this.lazyInputFn.bind(this),this.altInputFn=this.altInputFn.bind(this),this.altCheckFn=this.altCheckFn.bind(this),this.imgClassesFn=this.imgClassesFn.bind(this),this.figclassesFn=this.figclassesFn.bind(this),this.figcaptionFn=this.figcaptionFn.bind(this)}get parentId(){return this.getAttribute("parent-id")}get lazytext(){return this.getAttribute("lazy-label")}get alttext(){return this.getAttribute("alt-label")}get altchecktext(){return this.getAttribute("alt-check-label")}get altcheckdesctext(){return this.getAttribute("alt-check-desc-label")}get classestext(){return this.getAttribute("classes-label")}get figclassestext(){return this.getAttribute("figure-classes-label")}get figcaptiontext(){return this.getAttribute("figure-caption-label")}get summarytext(){return this.getAttribute("summary-label")}connectedCallback(){this.innerHTML=`\n<details open>\n  <summary>${this.summarytext}</summary>\n  <div class="">\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-alt">${this.alttext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-alt" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="form-check">\n        <input class="form-check-input" type="checkbox" id="${this.parentId}-alt-check">\n        <label class="form-check-label" for="${this.parentId}-alt-check">${this.altchecktext}</label>\n        <div><small class="form-text text-muted">${this.altcheckdesctext}</small></div>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="form-check">\n        <input class="form-check-input" type="checkbox" id="${this.parentId}-lazy" checked>\n        <label class="form-check-label" for="${this.parentId}-lazy">${this.lazytext}</label>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-classes">${this.classestext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-classes" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-figclasses">${this.figclassestext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-figclasses" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="${this.parentId}-figcaption">${this.figcaptiontext}</label>\n        <input class="form-control" type="text" id="${this.parentId}-figcaption" />\n      </div>\n    </div>\n  </div>\n</details>`,this.lazyInput=this.querySelector(`#${this.parentId}-lazy`),this.lazyInput.addEventListener("change",this.lazyInputFn),this.altInput=this.querySelector(`#${this.parentId}-alt`),this.altInput.addEventListener("input",this.altInputFn),this.altCheck=this.querySelector(`#${this.parentId}-alt-check`),this.altCheck.addEventListener("input",this.altCheckFn),this.imgClasses=this.querySelector(`#${this.parentId}-classes`),this.imgClasses.addEventListener("input",this.imgClassesFn),this.figClasses=this.querySelector(`#${this.parentId}-figclasses`),this.figClasses.addEventListener("input",this.figclassesFn),this.figCaption=this.querySelector(`#${this.parentId}-figcaption`),this.figCaption.addEventListener("input",this.figcaptionFn),this.setAttribute("is-lazy",!!this.lazyInput.checked),this.setAttribute("alt-value",""),this.setAttribute("alt-check",!1),this.setAttribute("img-classes",""),this.setAttribute("fig-classes",""),this.setAttribute("fig-caption","")}disconnectedCallback(){this.lazyInput.removeEventListener("input",this.lazyInputFn),this.altInput.removeEventListener("input",this.altInputFn),this.altCheck.removeEventListener("input",this.altCheckFn),this.imgClasses.removeEventListener("input",this.imgClassesFn),this.figClasses.removeEventListener("input",this.figclassesFn),this.figCaption.removeEventListener("input",this.figcaptionFn),this.innerHTML=""}lazyInputFn(t){this.setAttribute("is-lazy",!!t.target.checked)}altInputFn(t){this.setAttribute("alt-value",t.target.value.replace(/"/g,"&quot;"))}altCheckFn(t){this.setAttribute("alt-check",!!t.target.checked)}imgClassesFn(t){this.setAttribute("img-classes",t.target.value)}figclassesFn(t){this.setAttribute("fig-classes",t.target.value)}figcaptionFn(t){this.setAttribute("fig-caption",t.target.value)}}t.define("joomla-field-mediamore",a)})(customElements,Joomla);