import{B as BaseComponent,S as SelectorEngine,E as EventHandler,a as getTransitionDurationFromElement,T as TRANSITION_END,e as emulateTransitionEnd,c as typeCheckConfig,r as reflow,h as isRTL,M as Manipulator,D as Data,g as getElementFromSelector,i as isVisible,o as onDOMContentLoaded,b as getjQuery}from"./dom-8eef6b5f.js";const NAME="modal",DATA_KEY="bs.modal",EVENT_KEY=`.${DATA_KEY}`,DATA_API_KEY=".data-api",ESCAPE_KEY="Escape",Default={backdrop:!0,keyboard:!0,focus:!0},DefaultType={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"},EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,EVENT_FOCUSIN=`focusin${EVENT_KEY}`,EVENT_RESIZE=`resize${EVENT_KEY}`,EVENT_CLICK_DISMISS=`click.dismiss${EVENT_KEY}`,EVENT_KEYDOWN_DISMISS=`keydown.dismiss${EVENT_KEY}`,EVENT_MOUSEUP_DISMISS=`mouseup.dismiss${EVENT_KEY}`,EVENT_MOUSEDOWN_DISMISS=`mousedown.dismiss${EVENT_KEY}`,EVENT_CLICK_DATA_API=`click${EVENT_KEY}${DATA_API_KEY}`,CLASS_NAME_SCROLLBAR_MEASURER="modal-scrollbar-measure",CLASS_NAME_BACKDROP="modal-backdrop",CLASS_NAME_OPEN="modal-open",CLASS_NAME_FADE="fade",CLASS_NAME_SHOW="show",CLASS_NAME_STATIC="modal-static",SELECTOR_DIALOG=".modal-dialog",SELECTOR_MODAL_BODY=".modal-body",SELECTOR_DATA_TOGGLE='[data-bs-toggle="modal"]',SELECTOR_DATA_DISMISS='[data-bs-dismiss="modal"]',SELECTOR_FIXED_CONTENT=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",SELECTOR_STICKY_CONTENT=".sticky-top";class Modal extends BaseComponent{constructor(e,t){super(e),this._config=this._getConfig(t),this._dialog=SelectorEngine.findOne(SELECTOR_DIALOG,e),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}static get Default(){return Default}static get DATA_KEY(){return DATA_KEY}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||this._isTransitioning)return;this._element.classList.contains(CLASS_NAME_FADE)&&(this._isTransitioning=!0);const t=EventHandler.trigger(this._element,EVENT_SHOW,{relatedTarget:e});this._isShown||t.defaultPrevented||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),EventHandler.on(this._element,EVENT_CLICK_DISMISS,SELECTOR_DATA_DISMISS,(e=>this.hide(e))),EventHandler.on(this._dialog,EVENT_MOUSEDOWN_DISMISS,(()=>{EventHandler.one(this._element,EVENT_MOUSEUP_DISMISS,(e=>{e.target===this._element&&(this._ignoreBackdropClick=!0)}))})),this._showBackdrop((()=>this._showElement(e))))}hide(e){if(e&&e.preventDefault(),!this._isShown||this._isTransitioning)return;if(EventHandler.trigger(this._element,EVENT_HIDE).defaultPrevented)return;this._isShown=!1;const t=this._element.classList.contains(CLASS_NAME_FADE);if(t&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),EventHandler.off(document,EVENT_FOCUSIN),this._element.classList.remove(CLASS_NAME_SHOW),EventHandler.off(this._element,EVENT_CLICK_DISMISS),EventHandler.off(this._dialog,EVENT_MOUSEDOWN_DISMISS),t){const e=getTransitionDurationFromElement(this._element);EventHandler.one(this._element,TRANSITION_END,(e=>this._hideModal(e))),emulateTransitionEnd(this._element,e)}else this._hideModal()}dispose(){[window,this._element,this._dialog].forEach((e=>EventHandler.off(e,EVENT_KEY))),super.dispose(),EventHandler.off(document,EVENT_FOCUSIN),this._config=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null}handleUpdate(){this._adjustDialog()}_getConfig(e){return e={...Default,...e},typeCheckConfig(NAME,e,DefaultType),e}_showElement(e){const t=this._element.classList.contains(CLASS_NAME_FADE),i=SelectorEngine.findOne(SELECTOR_MODAL_BODY,this._dialog);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,i&&(i.scrollTop=0),t&&reflow(this._element),this._element.classList.add(CLASS_NAME_SHOW),this._config.focus&&this._enforceFocus();const o=()=>{this._config.focus&&this._element.focus(),this._isTransitioning=!1,EventHandler.trigger(this._element,EVENT_SHOWN,{relatedTarget:e})};if(t){const e=getTransitionDurationFromElement(this._dialog);EventHandler.one(this._dialog,TRANSITION_END,o),emulateTransitionEnd(this._dialog,e)}else o()}_enforceFocus(){EventHandler.off(document,EVENT_FOCUSIN),EventHandler.on(document,EVENT_FOCUSIN,(e=>{document===e.target||this._element===e.target||this._element.contains(e.target)||this._element.focus()}))}_setEscapeEvent(){this._isShown?EventHandler.on(this._element,EVENT_KEYDOWN_DISMISS,(e=>{this._config.keyboard&&e.key===ESCAPE_KEY?(e.preventDefault(),this.hide()):this._config.keyboard||e.key!==ESCAPE_KEY||this._triggerBackdropTransition()})):EventHandler.off(this._element,EVENT_KEYDOWN_DISMISS)}_setResizeEvent(){this._isShown?EventHandler.on(window,EVENT_RESIZE,(()=>this._adjustDialog())):EventHandler.off(window,EVENT_RESIZE)}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._showBackdrop((()=>{document.body.classList.remove(CLASS_NAME_OPEN),this._resetAdjustments(),this._resetScrollbar(),EventHandler.trigger(this._element,EVENT_HIDDEN)}))}_removeBackdrop(){this._backdrop.parentNode.removeChild(this._backdrop),this._backdrop=null}_showBackdrop(e){const t=this._element.classList.contains(CLASS_NAME_FADE)?CLASS_NAME_FADE:"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className=CLASS_NAME_BACKDROP,t&&this._backdrop.classList.add(t),document.body.appendChild(this._backdrop),EventHandler.on(this._element,EVENT_CLICK_DISMISS,(e=>{this._ignoreBackdropClick?this._ignoreBackdropClick=!1:e.target===e.currentTarget&&("static"===this._config.backdrop?this._triggerBackdropTransition():this.hide())})),t&&reflow(this._backdrop),this._backdrop.classList.add(CLASS_NAME_SHOW),!t)return void e();const i=getTransitionDurationFromElement(this._backdrop);EventHandler.one(this._backdrop,TRANSITION_END,e),emulateTransitionEnd(this._backdrop,i)}else if(!this._isShown&&this._backdrop){this._backdrop.classList.remove(CLASS_NAME_SHOW);const t=()=>{this._removeBackdrop(),e()};if(this._element.classList.contains(CLASS_NAME_FADE)){const e=getTransitionDurationFromElement(this._backdrop);EventHandler.one(this._backdrop,TRANSITION_END,t),emulateTransitionEnd(this._backdrop,e)}else t()}else e()}_triggerBackdropTransition(){if(EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight;e||(this._element.style.overflowY="hidden"),this._element.classList.add(CLASS_NAME_STATIC);const t=getTransitionDurationFromElement(this._dialog);EventHandler.off(this._element,TRANSITION_END),EventHandler.one(this._element,TRANSITION_END,(()=>{this._element.classList.remove(CLASS_NAME_STATIC),e||(EventHandler.one(this._element,TRANSITION_END,(()=>{this._element.style.overflowY=""})),emulateTransitionEnd(this._element,t))})),emulateTransitionEnd(this._element,t),this._element.focus()}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight;(!this._isBodyOverflowing&&e&&!isRTL||this._isBodyOverflowing&&!e&&isRTL)&&(this._element.style.paddingLeft=`${this._scrollbarWidth}px`),(this._isBodyOverflowing&&!e&&!isRTL||!this._isBodyOverflowing&&e&&isRTL)&&(this._element.style.paddingRight=`${this._scrollbarWidth}px`)}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}_checkScrollbar(){const e=document.body.getBoundingClientRect();this._isBodyOverflowing=Math.round(e.left+e.right)<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()}_setScrollbar(){if(this._isBodyOverflowing){SelectorEngine.find(SELECTOR_FIXED_CONTENT).forEach((e=>{const t=e.style.paddingRight,i=window.getComputedStyle(e)["padding-right"];Manipulator.setDataAttribute(e,"padding-right",t),e.style.paddingRight=`${Number.parseFloat(i)+this._scrollbarWidth}px`})),SelectorEngine.find(SELECTOR_STICKY_CONTENT).forEach((e=>{const t=e.style.marginRight,i=window.getComputedStyle(e)["margin-right"];Manipulator.setDataAttribute(e,"margin-right",t),e.style.marginRight=Number.parseFloat(i)-this._scrollbarWidth+"px"}));const e=document.body.style.paddingRight,t=window.getComputedStyle(document.body)["padding-right"];Manipulator.setDataAttribute(document.body,"padding-right",e),document.body.style.paddingRight=`${Number.parseFloat(t)+this._scrollbarWidth}px`}document.body.classList.add(CLASS_NAME_OPEN)}_resetScrollbar(){SelectorEngine.find(SELECTOR_FIXED_CONTENT).forEach((e=>{const t=Manipulator.getDataAttribute(e,"padding-right");void 0!==t&&(Manipulator.removeDataAttribute(e,"padding-right"),e.style.paddingRight=t)})),SelectorEngine.find(`${SELECTOR_STICKY_CONTENT}`).forEach((e=>{const t=Manipulator.getDataAttribute(e,"margin-right");void 0!==t&&(Manipulator.removeDataAttribute(e,"margin-right"),e.style.marginRight=t)}));const e=Manipulator.getDataAttribute(document.body,"padding-right");void 0===e?document.body.style.paddingRight="":(Manipulator.removeDataAttribute(document.body,"padding-right"),document.body.style.paddingRight=e)}_getScrollbarWidth(){const e=document.createElement("div");e.className=CLASS_NAME_SCROLLBAR_MEASURER,document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t}static jQueryInterface(e,t){return this.each((function(){let i=Data.getData(this,DATA_KEY);const o={...Default,...Manipulator.getDataAttributes(this),..."object"==typeof e&&e?e:{}};if(i||(i=new Modal(this,o)),"string"==typeof e){if(void 0===i[e])throw new TypeError(`No method named "${e}"`);i[e](t)}}))}}if(EventHandler.on(document,EVENT_CLICK_DATA_API,SELECTOR_DATA_TOGGLE,(function(e){const t=getElementFromSelector(this);"A"!==this.tagName&&"AREA"!==this.tagName||e.preventDefault(),EventHandler.one(t,EVENT_SHOW,(e=>{e.defaultPrevented||EventHandler.one(t,EVENT_HIDDEN,(()=>{isVisible(this)&&this.focus()}))}));let i=Data.getData(t,DATA_KEY);if(!i){const e={...Manipulator.getDataAttributes(t),...Manipulator.getDataAttributes(this)};i=new Modal(t,e)}i.show(this)})),onDOMContentLoaded((()=>{const e=getjQuery();if(e){const t=e.fn[NAME];e.fn[NAME]=Modal.jQueryInterface,e.fn[NAME].Constructor=Modal,e.fn[NAME].noConflict=()=>(e.fn[NAME]=t,Modal.jQueryInterface)}})),Joomla=Joomla||{},Joomla.Modal=Joomla.Modal||{},window.bootstrap=window.bootstrap||{},window.bootstrap.Modal=Modal,Joomla.initialiseModal=(modal,options)=>{modal instanceof Element&&(new window.bootstrap.Modal(modal,options),modal.open=()=>{window.bootstrap.Modal.getInstance(modal).show(modal)},modal.close=()=>{window.bootstrap.Modal.getInstance(modal).hide()},modal.addEventListener("show.bs.modal",(()=>{if(Joomla.Modal.setCurrent(modal),modal.dataset.url){const modalBody=modal.querySelector(".modal-body"),iframe=modalBody.querySelector("iframe");if(iframe){const e=modal.querySelector("joomla-field-mediamore");e&&e.parentNode.removeChild(e),iframe.parentNode.removeChild(iframe)}if(modal.dataset.iframe.indexOf("document.getElementById")>0){const iframeTextArr=modal.dataset.iframe.split("+"),idFieldArr=iframeTextArr[1].split('"');let el;idFieldArr[0]=idFieldArr[0].replace(/&quot;/g,'"'),el=document.getElementById(idFieldArr[1])?document.getElementById(idFieldArr[1]).value:eval(idFieldArr[0]),modalBody.insertAdjacentHTML("afterbegin",`${iframeTextArr[0]}${el}${iframeTextArr[2]}`)}else modalBody.insertAdjacentHTML("afterbegin",modal.dataset.iframe)}})),modal.addEventListener("shown.bs.modal",(()=>{const e=modal.querySelector(".modal-body"),t=modal.querySelector(".modal-header"),i=modal.querySelector(".modal-footer");let o=0,n=0,s=0,a=0,l=0;if(e){if(t){o=t.getBoundingClientRect().height,l=e.offsetHeight}i&&(n=parseFloat(getComputedStyle(i,null).height.replace("px","")));const r=parseFloat(getComputedStyle(e,null).height.replace("px","")),d=e.offsetTop;a=l-r,s=parseFloat(getComputedStyle(document.body,null).height.replace("px",""))-2*d-(o+n+a)}if(modal.dataset.url){const t=modal.querySelector("iframe");parseFloat(getComputedStyle(t,null).height.replace("px",""))>s&&(e.style.maxHeight=s,e.style.overflowY="auto",t.style.maxHeight=s-a)}})),modal.addEventListener("hide.bs.modal",(()=>{modal.querySelector(".modal-body").style.maxHeight="initial"})),modal.addEventListener("hidden.bs.modal",(()=>{Joomla.Modal.setCurrent("")})))},Joomla.iframeButtonClick=e=>{if(!e.iframeSelector||!e.buttonSelector)throw new Error("Selector is missing");const t=document.querySelector(`${e.iframeSelector} iframe`);if(t){const i=t.contentWindow.document.querySelector(e.buttonSelector);i&&i.click()}},Joomla&&Joomla.getOptions){const e=Joomla.getOptions("bootstrap.modal");"object"==typeof e&&null!==e&&Object.keys(e).forEach((t=>{const i=e[t],o={backdrop:!i.backdrop||i.backdrop,keyboard:!i.keyboard||i.keyboard,focus:!i.focus||i.focus};Array.from(document.querySelectorAll(t)).map((e=>Joomla.initialiseModal(e,o)))}))}export{Modal as M};