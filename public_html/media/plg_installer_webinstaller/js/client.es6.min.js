if(!Joomla)throw new Error("Joomla API is not properly initialised");((a,b,c)=>{'use strict';const d={view:"dashboard",id:0,ordering:"",version:"current",list:0,options:c.getOptions("plg_installer_webinstaller",{})};let e;class f{initialise(){d.loaded=1;const a=b.getElementById("uploadform-web-cancel");a.addEventListener("click",()=>{b.getElementById("uploadform-web").classList.add("hidden"),d.list&&b.querySelector(".list-view")&&b.querySelector(".list-view").click()});const c=b.getElementById("uploadform-web-install");c.addEventListener("click",()=>{4===d.options.installFrom?this.submitButtonUrl():this.submitButtonWeb()}),this.loadweb(`${d.options.base_url}index.php?format=json&option=com_apps&view=dashboard`),this.clickforlinks()}loadweb(e){if(!e)return!1;const g=new RegExp(d.options.base_url);if(!(g.test(e)||/^index.php/.test(e)))return a.open(e,"_blank"),!1;let h=`${e}&product=${d.options.product}&release=${d.options.release}&dev_level=${d.options.dev_level}&list=${d.list?"list":"grid"}&lang=${d.options.language}`;const i=b.getElementById("com-apps-ordering"),j=b.getElementById("com-apps-filter-joomla-version");return""!==d.ordering&&i&&i.value&&(d.ordering=i.value,h+=`&ordering=${d.ordering}`),""!==d.version&&j&&j.value&&(d.version=j.value,h+=`&filter_version=${d.version}`),f.showLoadingLayer(),new Promise((a,e)=>{c.request({url:h,onSuccess:c=>{let e;try{e=JSON.parse(c)}catch(a){throw new Error("Failed to parse JSON")}b.getElementById("web-loader")&&b.getElementById("web-loader").classList.add("hidden");const g=b.getElementById("jed-container");g.innerHTML=e.data.html,b.getElementById("com-apps-searchbox").addEventListener("keypress",({which:a})=>{13===a&&this.initiateSearch()}),b.getElementById("search-extensions").addEventListener("click",()=>{this.initiateSearch()}),b.getElementById("search-reset").addEventListener("click",()=>{const a=b.getElementById("com-apps-searchbox");a.value="",this.initiateSearch()});const h=b.getElementById("com-apps-ordering"),i=b.getElementById("com-apps-filter-joomla-version");h&&h.addEventListener("change",()=>{const a=h.selectedIndex;d.ordering=h.options[a].value,this.installfromwebajaxsubmit()}),i&&i.addEventListener("change",()=>{const a=i.selectedIndex;d.version=i.options[a].value,this.installfromwebajaxsubmit()}),""!==d.options.installfrom_url&&f.installfromweb(d.options.installfrom_url),a()},onError:a=>{const c=b.getElementById("web-loader-error"),d=b.getElementById("web-loader");a.responseText&&c&&(c.innerHTML=a.responseText),d&&(d.classList.add("hidden"),c.classList.remove("hidden")),e()}})}).finally(()=>{const e=b.getElementById("joomlaapsinstallatinput");if(e&&(e.value=d.options.installat_url),this.clickforlinks(),f.clicker(),"extension"!==d.view&&[].slice.call(b.querySelectorAll("div.load-extension")).forEach(a=>{a.addEventListener("click",b=>{b.preventDefault(),this.processLinkClick(a.getAttribute("data-url"))}),a.setAttribute("href","#")}),"extension"===d.view){const d=b.getElementById("install-extension"),e=b.getElementById("install-extension-from-external");d&&d.addEventListener("click",()=>{f.installfromweb(d.getAttribute("data-downloadurl"),d.getAttribute("data-name")),b.getElementById("uploadform-web-install").scrollIntoView({behavior:"smooth",block:"start"})}),e&&e.addEventListener("click",()=>{const d=e.getAttribute("data-downloadurl"),f=a.confirm(c.Text._("PLG_INSTALLER_WEBINSTALLER_REDIRECT_TO_EXTERNAL_SITE_TO_INSTALL").replace("[SITEURL]",d));!0!==f||(b.getElementById("adminForm").setAttribute("action",d),b.querySelector("input[name=task]").setAttribute("disabled",!0),b.querySelector("input[name=install_directory]").setAttribute("disabled",!0),b.querySelector("input[name=install_url]").setAttribute("disabled",!0),b.querySelector("input[name=installtype]").setAttribute("disabled",!0),b.querySelector("input[name=filter_search]").setAttribute("disabled",!0),b.getElementById("adminForm").submit())})}d.list&&b.querySelector(".list-view")&&b.querySelector(".list-view").click(),f.hideLoadingLayer()}),!0}clickforlinks(){[].slice.call(b.querySelectorAll("a.transcode")).forEach(a=>{const b=a.getAttribute("href");a.addEventListener("click",a=>{a.preventDefault(),this.processLinkClick(b)}),a.setAttribute("href","#")})}initiateSearch(){d.view="dashboard",this.installfromwebajaxsubmit()}installfromwebajaxsubmit(){let a=`&view=${d.view}`;if(d.id&&(a+=`&id=${d.id}`),b.getElementById("com-apps-searchbox").value){const c=encodeURI(b.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim());a+=`&filter_search=${c}`}const c=b.getElementById("com-apps-ordering"),e=b.getElementById("com-apps-filter-joomla-version");""!==d.ordering&&c&&c.value&&(d.ordering=c.value),d.ordering&&(a+=`&ordering=${d.ordering}`),""!==d.version&&e&&e.value&&(d.version=e.value),d.version&&(a+=`&filter_version=${d.version}`),this.loadweb(`${d.options.base_url}index.php?format=json&option=com_apps${a}`)}processLinkClick(a){const b=new RegExp(d.options.base_url);b.test(a)||/^index.php/.test(a)?(d.view=a.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===d.view?d.id=0:"category"===d.view&&(d.id=a.replace(/^.+[&?]id=(\d+).*$/,"$1")),this.loadweb(d.options.base_url+a)):this.loadweb(a)}static showLoadingLayer(){b.getElementById("web").appendChild(b.createElement("joomla-core-loader"))}static hideLoadingLayer(){const a=b.querySelector("#web joomla-core-loader");a.parentNode.removeChild(a)}static clicker(){b.querySelector(".grid-view")&&b.querySelector(".grid-view").addEventListener("click",()=>{d.list=0,b.querySelector(".list-container").classList.add("hidden"),b.querySelector(".grid-container").classList.remove("hidden"),b.getElementById("btn-list-view").classList.remove("active"),b.getElementById("btn-grid-view").classList.remove("active")}),b.querySelector(".list-view")&&b.querySelector(".list-view").addEventListener("click",()=>{d.list=1,b.querySelector(".grid-container").classList.add("hidden"),b.querySelector(".list-container").classList.remove("hidden"),b.getElementById("btn-grid-view").classList.remove("active"),b.getElementById("btn-list-view").classList.add("active")})}static installfromweb(a,d=null){return a?(b.getElementById("install_url").value=a,b.getElementById("uploadform-web-url").innerText=a,d?(b.getElementById("uploadform-web-name").innerText=d,b.getElementById("uploadform-web-name-label").classList.remove("hidden")):b.getElementById("uploadform-web-name-label").classList.add("hidden"),b.getElementById("uploadform-web").classList.remove("hidden"),!0):(c.renderMessages({warning:[c.Text._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")]}),!1)}submitButtonUrl(){const a=b.getElementById("adminForm");if(""===a.install_url.value||"http://"===a.install_url.value||"https://"===a.install_url.value)c.renderMessages({warning:[c.Text._("COM_INSTALLER_MSG_INSTALL_ENTER_A_URL")]});else{const c=b.getElementById("loading");c&&c.classList.remove("hidden"),a.installtype.value="url",a.submit()}}submitButtonWeb(){const a=b.getElementById("adminForm");""!==a.install_url.value||"http://"!==a.install_url.value||"https://"!==a.install_url.value?this.submitButtonUrl():""===a.install_url.value?c.renderMessages({warning:[c.apps.options.btntxt]}):(b.querySelector("#appsloading").classList.remove("hidden"),a.installtype.value="web",a.submit())}}b.addEventListener("DOMContentLoaded",()=>{const c=()=>{const g=b.getElementById("myTab");if("UL"!==g.firstElementChild.tagName)return void a.setTimeout(c,50);const h=g.querySelector("#tab-web");h&&(d.options.installfromon&&h.click(),h.hasAttribute("active")&&!e&&(e=new f,e.initialise()),""!==d.options.installfrom_url&&h.click(),h.addEventListener("joomla.tab.shown",()=>{e||(e=new f,e.initialise())}))};a.setTimeout(c,50)})})(window,document,Joomla);